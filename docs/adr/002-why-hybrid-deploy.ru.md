# ADR-002: Why mindustry has hybrid deploy

## Status
Accepted

Date: 2025-10-03

## Context
Mindustry оригинальный сервер имеет две большие проблемы:
- Один мир на инстанс в одно время
- Лишь вертикальное масштабирование
Multidustry изначально задумывался как проект с гибридным деплоем - распреленный и монолит, способный запускать несколько миров в отличие от оригинала
Необходимость создавать распределенную систему нужна для горизонтального масштабтрования компонентов и отказоустойчивости.
Необходимость в монолитом режиме запуска требуется для поддержания малых серверов

## Decision
Распределение на несколько компонентов:
- Apiserver - оркестрация кластром
- Proxy - транслятор внешнего трафика во внутренний формат и роутер игроков
- Gameserver - напосредственно симуляция
Два режима деплоя:
- Monolith
- Distributed
Создание транспортной абстракции для общения между частями системы:
- quic + cbor для сетевого общения
- kanal для общения внутри одного процесса

## Consequences

### Positive
- Горизонтальное масштабирование
- Отказоустойчивость
- Простота деплоя
- Лучший DX для разработки

### Negative
- Сложность разработки
- Необходимость создания абстракции транспорта
- Общее усложнение кодовой базы

### Neutral
- Все сообщения между компонентами должны быть Send + Sync + Serialize + DeserializeOwned

## Alternatives Considered

### Alternative 1: Only monolith
- **Pros**:
 - Простота разработки
 - Компоненты могут напрямую вызывать друг друга
 - Можно не разделять на отдельные модули
 - Простота деббагинга
- **Cons**:
 - Отсутствие горизонтального масштабирования
 - Отсутствие отказоустойчивости
 - Потенциальные проблемы с модульностью
- **Why rejected**: Не подходит под идею

### Alternative 2: Only distribeted
- **Pros**:
 - Не нужно писать абстракцию транспорта
 - Уменьшение размера кодовой базы за счет отказа от монолитной части
- **Cons**:
 - Плохой DX
 - Нужно понимать distributed debugging
 - Серьезный overhead для малых серверов
- **Why rejected**: Создание абстракции транспорта сложная, но выполнимая вещь.

## Related ADRs
- None

## References
- None
